{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Gard%20Eau%20Arbres/Desktop/genesis/utils/audio.ts"],"sourcesContent":["\r\nexport function decode(base64: string): Uint8Array {\r\n  const binaryString = atob(base64);\r\n  const len = binaryString.length;\r\n  const bytes = new Uint8Array(len);\r\n  for (let i = 0; i < len; i++) {\r\n    bytes[i] = binaryString.charCodeAt(i);\r\n  }\r\n  return bytes;\r\n}\r\n\r\nexport function encode(bytes: Uint8Array): string {\r\n  let binary = '';\r\n  const len = bytes.byteLength;\r\n  for (let i = 0; i < len; i++) {\r\n    binary += String.fromCharCode(bytes[i]);\r\n  }\r\n  return btoa(binary);\r\n}\r\n\r\nexport async function decodeAudioData(\r\n  data: Uint8Array,\r\n  ctx: AudioContext,\r\n  sampleRate: number,\r\n  numChannels: number,\r\n): Promise<AudioBuffer> {\r\n  const dataInt16 = new Int16Array(data.buffer);\r\n  const frameCount = dataInt16.length / numChannels;\r\n  const buffer = ctx.createBuffer(numChannels, frameCount, sampleRate);\r\n\r\n  for (let channel = 0; channel < numChannels; channel++) {\r\n    const channelData = buffer.getChannelData(channel);\r\n    for (let i = 0; i < frameCount; i++) {\r\n      channelData[i] = dataInt16[i * numChannels + channel] / 32768.0;\r\n    }\r\n  }\r\n  return buffer;\r\n}\r\n\r\nexport function createPcmBlob(data: Float32Array): { data: string; mimeType: string } {\r\n  const l = data.length;\r\n  const int16 = new Int16Array(l);\r\n  for (let i = 0; i < l; i++) {\r\n    int16[i] = data[i] * 32768;\r\n  }\r\n  return {\r\n    data: encode(new Uint8Array(int16.buffer)),\r\n    mimeType: 'audio/pcm;rate=16000',\r\n  };\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;AACO,SAAS,OAAO,MAAc;IACnC,MAAM,eAAe,KAAK;IAC1B,MAAM,MAAM,aAAa,MAAM;IAC/B,MAAM,QAAQ,IAAI,WAAW;IAC7B,IAAK,IAAI,IAAI,GAAG,IAAI,KAAK,IAAK;QAC5B,KAAK,CAAC,EAAE,GAAG,aAAa,UAAU,CAAC;IACrC;IACA,OAAO;AACT;AAEO,SAAS,OAAO,KAAiB;IACtC,IAAI,SAAS;IACb,MAAM,MAAM,MAAM,UAAU;IAC5B,IAAK,IAAI,IAAI,GAAG,IAAI,KAAK,IAAK;QAC5B,UAAU,OAAO,YAAY,CAAC,KAAK,CAAC,EAAE;IACxC;IACA,OAAO,KAAK;AACd;AAEO,eAAe,gBACpB,IAAgB,EAChB,GAAiB,EACjB,UAAkB,EAClB,WAAmB;IAEnB,MAAM,YAAY,IAAI,WAAW,KAAK,MAAM;IAC5C,MAAM,aAAa,UAAU,MAAM,GAAG;IACtC,MAAM,SAAS,IAAI,YAAY,CAAC,aAAa,YAAY;IAEzD,IAAK,IAAI,UAAU,GAAG,UAAU,aAAa,UAAW;QACtD,MAAM,cAAc,OAAO,cAAc,CAAC;QAC1C,IAAK,IAAI,IAAI,GAAG,IAAI,YAAY,IAAK;YACnC,WAAW,CAAC,EAAE,GAAG,SAAS,CAAC,IAAI,cAAc,QAAQ,GAAG;QAC1D;IACF;IACA,OAAO;AACT;AAEO,SAAS,cAAc,IAAkB;IAC9C,MAAM,IAAI,KAAK,MAAM;IACrB,MAAM,QAAQ,IAAI,WAAW;IAC7B,IAAK,IAAI,IAAI,GAAG,IAAI,GAAG,IAAK;QAC1B,KAAK,CAAC,EAAE,GAAG,IAAI,CAAC,EAAE,GAAG;IACvB;IACA,OAAO;QACL,MAAM,OAAO,IAAI,WAAW,MAAM,MAAM;QACxC,UAAU;IACZ;AACF"}},
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Gard%20Eau%20Arbres/Desktop/genesis/components/MultiAgentFusion.tsx"],"sourcesContent":["\r\nimport React, { useState, useRef, useEffect, useCallback } from 'react';\r\nimport { geminiService } from '../services/geminiService';\r\nimport { AgentPersona, GroundingChunk } from '../types';\r\nimport { sfx } from '../services/sfx';\r\nimport { decode, decodeAudioData } from '../utils/audio';\r\n\r\n// Interface étendue pour accepter les commandes du Cerveau Suprême\r\ninterface MultiAgentFusionProps {\r\n    initialParams?: { agentId: string; query: string } | null;\r\n    onConsumed?: () => void;\r\n}\r\n\r\nconst AGENTS: AgentPersona[] = [\r\n    {\r\n        id: 'mnemosyne',\r\n        name: 'Mnémosyne',\r\n        role: 'ARCHIVISTE',\r\n        color: 'text-purple-400',\r\n        icon: 'M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253',\r\n        description: 'Spécialiste de l\\'analyse documentaire, extraction de données et mémoire historique.',\r\n        systemPrompt: 'Tu es l\\'Archiviste. Ta mission est d\\'analyser les documents (PDF, Images, Texte), d\\'extraire les données cachées, de résumer et de retrouver les sources. Commence par un résumé vocal bref.'\r\n    },\r\n    {\r\n        id: 'athena',\r\n        name: 'Athena',\r\n        role: 'STRATÈGE',\r\n        color: 'text-blue-400',\r\n        icon: 'M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z',\r\n        description: 'Planification architecturale et optimisation du code.',\r\n        systemPrompt: 'Tu es la Stratège. Tu optimises l\\'architecture et coordonnes les actions globales. Tes réponses sont structurées et orientées solution.'\r\n    },\r\n    {\r\n        id: 'argus',\r\n        name: 'Argus',\r\n        role: 'SENTINELLE',\r\n        color: 'text-red-400',\r\n        icon: 'M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z',\r\n        description: 'Surveillance des menaces et protocoles de sécurité.',\r\n        systemPrompt: 'Tu es la Sentinelle. Tu surveilles les menaces actives et protèges l\\'intégrité du système. Ton ton est autoritaire et protecteur.'\r\n    },\r\n    {\r\n        id: 'atlas',\r\n        name: 'Atlas',\r\n        role: 'CARTOGRAPHE',\r\n        color: 'text-green-400',\r\n        icon: 'M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7',\r\n        description: 'Géolocalisation et analyse spatiale.',\r\n        systemPrompt: 'Tu es le Cartographe. Tu analyses les données géospatiales et la topologie du réseau. Utilise Google Maps grounding si pertinent.'\r\n    }\r\n];\r\n\r\nconst MultiAgentFusion: React.FC<MultiAgentFusionProps> = ({ initialParams, onConsumed }) => {\r\n    const [activeAgentId, setActiveAgentId] = useState('mnemosyne');\r\n    const [query, setQuery] = useState('');\r\n    const [messages, setMessages] = useState<{role: 'user' | 'agent', text: string, agent?: string, sources?: GroundingChunk[], isThinking?: boolean}[]>([]);\r\n    const [loading, setLoading] = useState(false);\r\n    const [uploadedFile, setUploadedFile] = useState<{name: string, type: string, base64: string} | null>(null);\r\n    const [fusionMode, setFusionMode] = useState(false);\r\n    const [isSpeaking, setIsSpeaking] = useState(false);\r\n\r\n    const activeAgent = AGENTS.find(a => a.id === activeAgentId) || AGENTS[0];\r\n    const fileInputRef = useRef<HTMLInputElement>(null);\r\n    const endOfMsgRef = useRef<HTMLDivElement>(null);\r\n    const audioContextRef = useRef<AudioContext | null>(null);\r\n\r\n    // Auto-scroll à chaque nouveau message\r\n    useEffect(() => {\r\n        if (endOfMsgRef.current) {\r\n            endOfMsgRef.current.scrollIntoView({ behavior: \"smooth\", block: \"end\" });\r\n        }\r\n    }, [messages, loading]);\r\n\r\n    // Réaction aux commandes externes (Voix)\r\n    useEffect(() => {\r\n        if (initialParams) {\r\n            const agentExists = AGENTS.find(a => a.id === initialParams.agentId || a.role === initialParams.agentId);\r\n            if (agentExists) {\r\n                setActiveAgentId(agentExists.id);\r\n            }\r\n            if (initialParams.query) {\r\n                setQuery(initialParams.query);\r\n                // Déclenchement automatique\r\n                setTimeout(() => triggerExternalSubmit(initialParams.query, agentExists?.id || activeAgentId), 500);\r\n            }\r\n            onConsumed?.();\r\n        }\r\n    }, [initialParams, onConsumed]);\r\n\r\n    const speakResponse = async (text: string) => {\r\n        setIsSpeaking(true);\r\n        try {\r\n            // On ne lit que les 300 premiers caractères pour ne pas saturer l'audio\r\n            const intro = text.split('\\n')[0].substring(0, 300); \r\n            const audioData = await geminiService.textToSpeech(intro);\r\n            \r\n            if (audioData) {\r\n                if (!audioContextRef.current) {\r\n                    audioContextRef.current = new (window.AudioContext || (window as any).webkitAudioContext)({ sampleRate: 24000 });\r\n                }\r\n                const ctx = audioContextRef.current;\r\n                if (ctx.state === 'suspended') await ctx.resume();\r\n                \r\n                const buffer = await decodeAudioData(decode(audioData), ctx, 24000, 1);\r\n                const source = ctx.createBufferSource();\r\n                source.buffer = buffer;\r\n                source.connect(ctx.destination);\r\n                source.onended = () => setIsSpeaking(false);\r\n                source.start(0);\r\n            } else {\r\n                setIsSpeaking(false);\r\n            }\r\n        } catch (e) {\r\n            console.warn(\"TTS Error\", e);\r\n            setIsSpeaking(false);\r\n        }\r\n    };\r\n\r\n    const triggerExternalSubmit = async (text: string, agentId: string) => {\r\n        // Version simplifiée de handleSubmit pour les appels externes\r\n        setMessages(prev => [...prev, { role: 'user', text: `[COMMANDE VOCALE] ${text}` }]);\r\n        setLoading(true);\r\n        sfx.playData();\r\n        \r\n        try {\r\n            const agent = AGENTS.find(a => a.id === agentId) || AGENTS[0];\r\n            setMessages(prev => [...prev, { role: 'agent', text: \"Traitement de la requête prioritaire...\", agent: agent.role, isThinking: true }]);\r\n            \r\n            const res = await geminiService.agentQuery(agent.role, agent.systemPrompt, text);\r\n            \r\n            setMessages(prev => {\r\n                const clean = prev.filter(m => !m.isThinking);\r\n                return [...clean, { role: 'agent', text: res.text, agent: agent.role, sources: res.sources }];\r\n            });\r\n            sfx.playConfirm();\r\n            await speakResponse(res.text);\r\n        } catch(e) {\r\n             setMessages(prev => [...prev, { role: 'agent', text: \"Échec de la commande vocale.\", agent: 'SYSTEM' }]);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0];\r\n        if (file) {\r\n            if (file.size > 10 * 1024 * 1024) { \r\n                window.alert(\"ATTENTION: Fichier trop volumineux (>10MB).\");\r\n                return;\r\n            }\r\n\r\n            const reader = new FileReader();\r\n            reader.onload = (ev) => {\r\n                if (ev.target?.result) {\r\n                    const base64 = (ev.target.result as string).split(',')[1]; \r\n                    setUploadedFile({ name: file.name, type: file.type, base64 });\r\n                    sfx.playConfirm();\r\n                    // Force switch to Archivist\r\n                    if (activeAgentId !== 'mnemosyne') setActiveAgentId('mnemosyne');\r\n                }\r\n            };\r\n            reader.readAsDataURL(file);\r\n        }\r\n    };\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!query.trim() && !uploadedFile) return;\r\n\r\n        const currentQuery = query;\r\n        const currentFile = uploadedFile;\r\n        \r\n        setQuery('');\r\n        setUploadedFile(null);\r\n        setMessages(prev => [...prev, { role: 'user', text: currentFile ? `[FICHIER: ${currentFile.name}] ${currentQuery}` : currentQuery }]);\r\n        setLoading(true);\r\n        sfx.playData();\r\n\r\n        try {\r\n            if (fusionMode) {\r\n                // FUSION MODE\r\n                for (const agent of AGENTS) {\r\n                    setMessages(prev => [...prev, { role: 'agent', text: \"Calcul en cours...\", agent: agent.role, isThinking: true }]);\r\n                    const res = await geminiService.agentQuery(agent.role, agent.systemPrompt, currentQuery);\r\n                    setMessages(prev => {\r\n                        const others = prev.filter(m => !(m.agent === agent.role && m.isThinking));\r\n                        return [...others, { role: 'agent', text: res.text, agent: agent.role, sources: res.sources }];\r\n                    });\r\n                    await new Promise(r => setTimeout(r, 500)); \r\n                }\r\n                sfx.playConfirm();\r\n            } else if (currentFile) {\r\n                // DOCUMENT ANALYSIS\r\n                setMessages(prev => [...prev, { role: 'agent', text: \"Lecture et décryptage du fichier...\", agent: 'ARCHIVISTE', isThinking: true }]);\r\n                const analysis = await geminiService.analyzeDocument(currentFile.base64, currentFile.type, currentQuery);\r\n                setMessages(prev => {\r\n                    const clean = prev.filter(m => !m.isThinking);\r\n                    return [...clean, { role: 'agent', text: analysis, agent: 'ARCHIVISTE' }];\r\n                });\r\n                sfx.playConfirm();\r\n                await speakResponse(analysis);\r\n            } else {\r\n                // SINGLE AGENT\r\n                setMessages(prev => [...prev, { role: 'agent', text: \"Connexion...\", agent: activeAgent.role, isThinking: true }]);\r\n                const res = await geminiService.agentQuery(activeAgent.role, activeAgent.systemPrompt, currentQuery);\r\n                setMessages(prev => {\r\n                    const clean = prev.filter(m => !m.isThinking);\r\n                    return [...clean, { role: 'agent', text: res.text, agent: activeAgent.role, sources: res.sources }];\r\n                });\r\n                sfx.playConfirm();\r\n                await speakResponse(res.text);\r\n            }\r\n        } catch (err) {\r\n            setMessages(prev => [...prev, { role: 'agent', text: \"ERREUR CRITIQUE DE COMMUNICATION NEURALE.\", agent: 'KERNEL' }]);\r\n            sfx.playAlert();\r\n        } finally {\r\n            setLoading(false);\r\n            setFusionMode(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"h-full flex flex-col gap-6 animate-fadeIn\">\r\n            {/* HEADER NEXUS */}\r\n            <div className=\"flex justify-between items-end shrink-0\">\r\n                <div>\r\n                    <h2 className=\"text-2xl md:text-4xl font-bold font-heading mb-2 flex items-center gap-3\">\r\n                        <div className=\"relative\">\r\n                            <div className={`w-8 h-8 rounded-full border-2 border-white/20 ${loading ? 'animate-spin' : ''}`}></div>\r\n                            <div className=\"absolute inset-0 flex items-center justify-center\">\r\n                                <div className={`w-2 h-2 rounded-full ${isSpeaking ? 'bg-green-500 animate-ping' : 'bg-blue-500'}`}></div>\r\n                            </div>\r\n                        </div>\r\n                        NEXUS\r\n                    </h2>\r\n                    <p className=\"text-gray-400 font-mono text-[10px] md:text-xs uppercase tracking-[0.3em]\">\r\n                        {isSpeaking ? 'TRANSMISSION VOCALE...' : 'FUSION COGNITIVE'}\r\n                    </p>\r\n                </div>\r\n                \r\n                <div className=\"flex gap-4\">\r\n                    <button \r\n                        onClick={() => setFusionMode(!fusionMode)}\r\n                        className={`px-4 md:px-6 py-2 md:py-3 rounded-xl font-bold uppercase tracking-widest text-[9px] md:text-[10px] transition-all border ${fusionMode ? 'bg-gradient-to-r from-purple-600 to-blue-600 text-white border-transparent shadow-[0_0_30px_rgba(147,51,234,0.5)]' : 'bg-white/5 border-white/10 text-gray-500 hover:text-white'}`}\r\n                    >\r\n                        {fusionMode ? 'FUSION ACTIVE' : 'MODE FUSION'}\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"flex-1 grid grid-cols-1 lg:grid-cols-4 gap-6 min-h-0\">\r\n                {/* SELECTEUR D'AGENTS RESPONSIVE */}\r\n                <div className=\"lg:col-span-1 space-y-4 flex flex-col min-h-0\">\r\n                    {/* Sur mobile : défilement horizontal (flex-row), sur desktop : vertical (flex-col) */}\r\n                    <div className=\"glass p-1 rounded-2xl bg-black/40 flex-none flex flex-row lg:flex-col gap-2 overflow-x-auto lg:overflow-x-hidden lg:overflow-y-auto custom-scrollbar lg:flex-1 snap-x\">\r\n                        {AGENTS.map(agent => (\r\n                            <button\r\n                                key={agent.id}\r\n                                onClick={() => setActiveAgentId(agent.id)}\r\n                                className={`p-4 rounded-xl text-left transition-all border relative overflow-hidden group shrink-0 w-64 lg:w-auto snap-center ${activeAgentId === agent.id ? 'bg-white/10 border-white/20' : 'bg-transparent border-transparent hover:bg-white/5'}`}\r\n                            >\r\n                                <div className=\"flex items-center gap-4 relative z-10\">\r\n                                    <div className={`w-10 h-10 rounded-lg flex items-center justify-center bg-black/50 border border-white/10 ${agent.color}`}>\r\n                                        <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d={agent.icon} /></svg>\r\n                                    </div>\r\n                                    <div>\r\n                                        <p className={`font-bold uppercase tracking-wider text-xs ${activeAgentId === agent.id ? 'text-white' : 'text-gray-500'}`}>{agent.role}</p>\r\n                                        <p className=\"text-[10px] font-bold text-gray-400\">{agent.name}</p>\r\n                                    </div>\r\n                                </div>\r\n                                {activeAgentId === agent.id && <div className={`absolute left-0 top-0 bottom-0 w-1 ${agent.color.replace('text', 'bg')}`}></div>}\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n                    \r\n                    {/* INFO AGENT ACTIF (Masqué sur petit mobile si pas assez de place ?) */}\r\n                    <div className=\"glass p-6 rounded-2xl border border-white/10 bg-gradient-to-br from-black to-gray-900 hidden md:block\">\r\n                        <h3 className={`text-lg font-bold mb-2 ${activeAgent.color}`}>{activeAgent.name}</h3>\r\n                        <p className=\"text-xs text-gray-400 leading-relaxed mb-4\">{activeAgent.description}</p>\r\n                        <div className=\"h-1 w-full bg-gray-800 rounded-full overflow-hidden\">\r\n                            <div className={`h-full w-2/3 ${activeAgent.color.replace('text', 'bg')} animate-pulse`}></div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* ZONE DE CHAT CENTRALE */}\r\n                <div className=\"lg:col-span-3 glass rounded-[2rem] flex flex-col bg-black/40 border border-white/5 relative overflow-hidden\">\r\n                    {/* FLUX DE MESSAGES */}\r\n                    <div className=\"flex-1 overflow-y-auto custom-scrollbar p-6 space-y-6\">\r\n                        {messages.length === 0 && (\r\n                            <div className=\"h-full flex flex-col items-center justify-center opacity-60 select-none p-8 text-center\">\r\n                                <div className=\"w-24 h-24 border border-dashed rounded-full flex items-center justify-center animate-spin-slow mb-6 border-blue-500/30\">\r\n                                    <div className=\"w-16 h-16 border border-dotted rounded-full border-purple-500/50\"></div>\r\n                                </div>\r\n                                <h3 className=\"text-xl font-bold font-heading text-white mb-2\">NEXUS NEURAL</h3>\r\n                                <p className=\"text-xs text-gray-400 max-w-md leading-relaxed mb-6\">\r\n                                    Système central de fusion multi-agents.\r\n                                </p>\r\n                                <p className=\"font-mono text-[10px] uppercase tracking-[0.2em] text-gray-600\">En attente de données...</p>\r\n                            </div>\r\n                        )}\r\n                        {messages.map((msg, i) => (\r\n                            <div key={i} className={`flex flex-col gap-1 max-w-[95%] md:max-w-[85%] ${msg.role === 'user' ? 'self-end items-end' : 'self-start items-start'} animate-slideIn`}>\r\n                                <span className=\"text-[8px] font-bold uppercase tracking-widest text-gray-600 px-2\">\r\n                                    {msg.agent || 'ADMIN'}\r\n                                </span>\r\n                                <div className={`p-5 rounded-2xl text-xs md:text-sm leading-relaxed whitespace-pre-wrap ${\r\n                                    msg.role === 'user' \r\n                                    ? 'bg-blue-600 text-white rounded-tr-none shadow-lg shadow-blue-900/20' \r\n                                    : msg.isThinking \r\n                                        ? 'bg-white/5 border border-white/10 text-gray-400 animate-pulse'\r\n                                        : 'glass bg-black/60 border border-white/10 text-gray-300 rounded-tl-none'\r\n                                }`}>\r\n                                    {msg.text}\r\n                                    {msg.sources && msg.sources.length > 0 && (\r\n                                        <div className=\"mt-4 pt-4 border-t border-white/10\">\r\n                                            <p className=\"text-[9px] uppercase font-bold text-gray-500 mb-2\">Sources Détectées :</p>\r\n                                            <div className=\"flex flex-wrap gap-2\">\r\n                                                {msg.sources.map((src, idx) => (\r\n                                                    src.web && (\r\n                                                        <a key={idx} href={src.web.uri} target=\"_blank\" rel=\"noreferrer\" className=\"text-[9px] bg-white/5 px-2 py-1 rounded hover:bg-white/10 text-blue-300 truncate max-w-[200px] border border-white/5 block\">\r\n                                                            {src.web.title}\r\n                                                        </a>\r\n                                                    )\r\n                                                ))}\r\n                                            </div>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                        <div ref={endOfMsgRef} className=\"h-4\" />\r\n                    </div>\r\n\r\n                    {/* BARRE DE SAISIE */}\r\n                    <div className=\"p-4 bg-black/60 border-t border-white/5 backdrop-blur-md\">\r\n                        {uploadedFile && (\r\n                            <div className=\"mb-2 flex items-center gap-2 bg-blue-900/30 px-3 py-1.5 rounded-lg border border-blue-500/30 w-fit animate-slideIn\">\r\n                                <svg className=\"w-4 h-4 text-blue-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" /></svg>\r\n                                <span className=\"text-xs text-blue-200 font-mono\">{uploadedFile.name}</span>\r\n                                <button onClick={() => setUploadedFile(null)} className=\"text-blue-400 hover:text-white ml-2\">×</button>\r\n                            </div>\r\n                        )}\r\n                        <form onSubmit={handleSubmit} className=\"flex gap-2 md:gap-3 relative\">\r\n                            <input \r\n                                type=\"file\" \r\n                                ref={fileInputRef} \r\n                                onChange={handleFileUpload} \r\n                                className=\"hidden\" \r\n                                accept=\".pdf,.txt,.md,.json,.js,.ts,.csv,.jpg,.png\" \r\n                            />\r\n                            <button \r\n                                type=\"button\" \r\n                                onClick={() => fileInputRef.current?.click()}\r\n                                className=\"p-4 rounded-xl bg-white/5 hover:bg-white/10 text-gray-400 hover:text-white transition-all border border-white/5 shrink-0\"\r\n                                title=\"Charger Document\"\r\n                            >\r\n                                <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13\" /></svg>\r\n                            </button>\r\n                            <input \r\n                                type=\"text\" \r\n                                value={query}\r\n                                onChange={(e) => setQuery(e.target.value)}\r\n                                placeholder={fusionMode ? \"Interroger le Nexus...\" : `Instructions pour ${activeAgent.name}...`}\r\n                                className=\"flex-1 bg-white/5 border border-white/10 rounded-xl px-4 md:px-6 font-mono text-sm focus:outline-none focus:bg-black/80 focus:border-blue-500/50 transition-all placeholder:text-gray-600 text-white min-w-0\"\r\n                            />\r\n                            <button \r\n                                type=\"submit\" \r\n                                disabled={loading || (!query.trim() && !uploadedFile)}\r\n                                className=\"px-4 md:px-8 bg-blue-600 hover:bg-blue-500 text-white rounded-xl font-bold uppercase tracking-widest text-[10px] shadow-[0_0_20px_rgba(37,99,235,0.3)] disabled:opacity-50 disabled:shadow-none transition-all shrink-0\"\r\n                            >\r\n                                <span className=\"hidden md:inline\">TRANSMETTRE</span>\r\n                                <span className=\"md:hidden\">→</span>\r\n                            </button>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default MultiAgentFusion;\r\n"],"names":[],"mappings":";;;;;AACA;AACA;AAEA;AACA;;;;;;AAQA,MAAM,SAAyB;IAC3B;QACI,IAAI;QACJ,MAAM;QACN,MAAM;QACN,OAAO;QACP,MAAM;QACN,aAAa;QACb,cAAc;IAClB;IACA;QACI,IAAI;QACJ,MAAM;QACN,MAAM;QACN,OAAO;QACP,MAAM;QACN,aAAa;QACb,cAAc;IAClB;IACA;QACI,IAAI;QACJ,MAAM;QACN,MAAM;QACN,OAAO;QACP,MAAM;QACN,aAAa;QACb,cAAc;IAClB;IACA;QACI,IAAI;QACJ,MAAM;QACN,MAAM;QACN,OAAO;QACP,MAAM;QACN,aAAa;QACb,cAAc;IAClB;CACH;AAED,MAAM,mBAAoD,CAAC,EAAE,aAAa,EAAE,UAAU,EAAE;IACpF,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,uOAAQ,EAAC;IACnD,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,uOAAQ,EAAC;IACnC,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,uOAAQ,EAA6G,EAAE;IACvJ,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,uOAAQ,EAAC;IACvC,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,uOAAQ,EAAsD;IACtG,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,uOAAQ,EAAC;IAC7C,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,uOAAQ,EAAC;IAE7C,MAAM,cAAc,OAAO,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,kBAAkB,MAAM,CAAC,EAAE;IACzE,MAAM,eAAe,IAAA,qOAAM,EAAmB;IAC9C,MAAM,cAAc,IAAA,qOAAM,EAAiB;IAC3C,MAAM,kBAAkB,IAAA,qOAAM,EAAsB;IAEpD,uCAAuC;IACvC,IAAA,wOAAS,EAAC;QACN,IAAI,YAAY,OAAO,EAAE;YACrB,YAAY,OAAO,CAAC,cAAc,CAAC;gBAAE,UAAU;gBAAU,OAAO;YAAM;QAC1E;IACJ,GAAG;QAAC;QAAU;KAAQ;IAEtB,yCAAyC;IACzC,IAAA,wOAAS,EAAC;QACN,IAAI,eAAe;YACf,MAAM,cAAc,OAAO,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,cAAc,OAAO,IAAI,EAAE,IAAI,KAAK,cAAc,OAAO;YACvG,IAAI,aAAa;gBACb,iBAAiB,YAAY,EAAE;YACnC;YACA,IAAI,cAAc,KAAK,EAAE;gBACrB,SAAS,cAAc,KAAK;gBAC5B,4BAA4B;gBAC5B,WAAW,IAAM,sBAAsB,cAAc,KAAK,EAAE,aAAa,MAAM,gBAAgB;YACnG;YACA;QACJ;IACJ,GAAG;QAAC;QAAe;KAAW;IAE9B,MAAM,gBAAgB,OAAO;QACzB,cAAc;QACd,IAAI;YACA,wEAAwE;YACxE,MAAM,QAAQ,KAAK,KAAK,CAAC,KAAK,CAAC,EAAE,CAAC,SAAS,CAAC,GAAG;YAC/C,MAAM,YAAY,MAAM,gKAAa,CAAC,YAAY,CAAC;YAEnD,IAAI,WAAW;gBACX,IAAI,CAAC,gBAAgB,OAAO,EAAE;oBAC1B,gBAAgB,OAAO,GAAG,IAAI,CAAC,OAAO,YAAY,IAAI,AAAC,OAAe,kBAAkB,EAAE;wBAAE,YAAY;oBAAM;gBAClH;gBACA,MAAM,MAAM,gBAAgB,OAAO;gBACnC,IAAI,IAAI,KAAK,KAAK,aAAa,MAAM,IAAI,MAAM;gBAE/C,MAAM,SAAS,MAAM,IAAA,uJAAe,EAAC,IAAA,8IAAM,EAAC,YAAY,KAAK,OAAO;gBACpE,MAAM,SAAS,IAAI,kBAAkB;gBACrC,OAAO,MAAM,GAAG;gBAChB,OAAO,OAAO,CAAC,IAAI,WAAW;gBAC9B,OAAO,OAAO,GAAG,IAAM,cAAc;gBACrC,OAAO,KAAK,CAAC;YACjB,OAAO;gBACH,cAAc;YAClB;QACJ,EAAE,OAAO,GAAG;YACR,QAAQ,IAAI,CAAC,aAAa;YAC1B,cAAc;QAClB;IACJ;IAEA,MAAM,wBAAwB,OAAO,MAAc;QAC/C,8DAA8D;QAC9D,YAAY,CAAA,OAAQ;mBAAI;gBAAM;oBAAE,MAAM;oBAAQ,MAAM,CAAC,kBAAkB,EAAE,MAAM;gBAAC;aAAE;QAClF,WAAW;QACX,4IAAG,CAAC,QAAQ;QAEZ,IAAI;YACA,MAAM,QAAQ,OAAO,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,YAAY,MAAM,CAAC,EAAE;YAC7D,YAAY,CAAA,OAAQ;uBAAI;oBAAM;wBAAE,MAAM;wBAAS,MAAM;wBAA2C,OAAO,MAAM,IAAI;wBAAE,YAAY;oBAAK;iBAAE;YAEtI,MAAM,MAAM,MAAM,gKAAa,CAAC,UAAU,CAAC,MAAM,IAAI,EAAE,MAAM,YAAY,EAAE;YAE3E,YAAY,CAAA;gBACR,MAAM,QAAQ,KAAK,MAAM,CAAC,CAAA,IAAK,CAAC,EAAE,UAAU;gBAC5C,OAAO;uBAAI;oBAAO;wBAAE,MAAM;wBAAS,MAAM,IAAI,IAAI;wBAAE,OAAO,MAAM,IAAI;wBAAE,SAAS,IAAI,OAAO;oBAAC;iBAAE;YACjG;YACA,4IAAG,CAAC,WAAW;YACf,MAAM,cAAc,IAAI,IAAI;QAChC,EAAE,OAAM,GAAG;YACN,YAAY,CAAA,OAAQ;uBAAI;oBAAM;wBAAE,MAAM;wBAAS,MAAM;wBAAgC,OAAO;oBAAS;iBAAE;QAC5G,SAAU;YACN,WAAW;QACf;IACJ;IAEA,MAAM,mBAAmB,CAAC;QACtB,MAAM,OAAO,EAAE,MAAM,CAAC,KAAK,EAAE,CAAC,EAAE;QAChC,IAAI,MAAM;YACN,IAAI,KAAK,IAAI,GAAG,KAAK,OAAO,MAAM;gBAC9B,OAAO,KAAK,CAAC;gBACb;YACJ;YAEA,MAAM,SAAS,IAAI;YACnB,OAAO,MAAM,GAAG,CAAC;gBACb,IAAI,GAAG,MAAM,EAAE,QAAQ;oBACnB,MAAM,SAAS,AAAC,GAAG,MAAM,CAAC,MAAM,CAAY,KAAK,CAAC,IAAI,CAAC,EAAE;oBACzD,gBAAgB;wBAAE,MAAM,KAAK,IAAI;wBAAE,MAAM,KAAK,IAAI;wBAAE;oBAAO;oBAC3D,4IAAG,CAAC,WAAW;oBACf,4BAA4B;oBAC5B,IAAI,kBAAkB,aAAa,iBAAiB;gBACxD;YACJ;YACA,OAAO,aAAa,CAAC;QACzB;IACJ;IAEA,MAAM,eAAe,OAAO;QACxB,EAAE,cAAc;QAChB,IAAI,CAAC,MAAM,IAAI,MAAM,CAAC,cAAc;QAEpC,MAAM,eAAe;QACrB,MAAM,cAAc;QAEpB,SAAS;QACT,gBAAgB;QAChB,YAAY,CAAA,OAAQ;mBAAI;gBAAM;oBAAE,MAAM;oBAAQ,MAAM,cAAc,CAAC,UAAU,EAAE,YAAY,IAAI,CAAC,EAAE,EAAE,cAAc,GAAG;gBAAa;aAAE;QACpI,WAAW;QACX,4IAAG,CAAC,QAAQ;QAEZ,IAAI;YACA,IAAI,YAAY;gBACZ,cAAc;gBACd,KAAK,MAAM,SAAS,OAAQ;oBACxB,YAAY,CAAA,OAAQ;+BAAI;4BAAM;gCAAE,MAAM;gCAAS,MAAM;gCAAsB,OAAO,MAAM,IAAI;gCAAE,YAAY;4BAAK;yBAAE;oBACjH,MAAM,MAAM,MAAM,gKAAa,CAAC,UAAU,CAAC,MAAM,IAAI,EAAE,MAAM,YAAY,EAAE;oBAC3E,YAAY,CAAA;wBACR,MAAM,SAAS,KAAK,MAAM,CAAC,CAAA,IAAK,CAAC,CAAC,EAAE,KAAK,KAAK,MAAM,IAAI,IAAI,EAAE,UAAU;wBACxE,OAAO;+BAAI;4BAAQ;gCAAE,MAAM;gCAAS,MAAM,IAAI,IAAI;gCAAE,OAAO,MAAM,IAAI;gCAAE,SAAS,IAAI,OAAO;4BAAC;yBAAE;oBAClG;oBACA,MAAM,IAAI,QAAQ,CAAA,IAAK,WAAW,GAAG;gBACzC;gBACA,4IAAG,CAAC,WAAW;YACnB,OAAO,IAAI,aAAa;gBACpB,oBAAoB;gBACpB,YAAY,CAAA,OAAQ;2BAAI;wBAAM;4BAAE,MAAM;4BAAS,MAAM;4BAAuC,OAAO;4BAAc,YAAY;wBAAK;qBAAE;gBACpI,MAAM,WAAW,MAAM,gKAAa,CAAC,eAAe,CAAC,YAAY,MAAM,EAAE,YAAY,IAAI,EAAE;gBAC3F,YAAY,CAAA;oBACR,MAAM,QAAQ,KAAK,MAAM,CAAC,CAAA,IAAK,CAAC,EAAE,UAAU;oBAC5C,OAAO;2BAAI;wBAAO;4BAAE,MAAM;4BAAS,MAAM;4BAAU,OAAO;wBAAa;qBAAE;gBAC7E;gBACA,4IAAG,CAAC,WAAW;gBACf,MAAM,cAAc;YACxB,OAAO;gBACH,eAAe;gBACf,YAAY,CAAA,OAAQ;2BAAI;wBAAM;4BAAE,MAAM;4BAAS,MAAM;4BAAgB,OAAO,YAAY,IAAI;4BAAE,YAAY;wBAAK;qBAAE;gBACjH,MAAM,MAAM,MAAM,gKAAa,CAAC,UAAU,CAAC,YAAY,IAAI,EAAE,YAAY,YAAY,EAAE;gBACvF,YAAY,CAAA;oBACR,MAAM,QAAQ,KAAK,MAAM,CAAC,CAAA,IAAK,CAAC,EAAE,UAAU;oBAC5C,OAAO;2BAAI;wBAAO;4BAAE,MAAM;4BAAS,MAAM,IAAI,IAAI;4BAAE,OAAO,YAAY,IAAI;4BAAE,SAAS,IAAI,OAAO;wBAAC;qBAAE;gBACvG;gBACA,4IAAG,CAAC,WAAW;gBACf,MAAM,cAAc,IAAI,IAAI;YAChC;QACJ,EAAE,OAAO,KAAK;YACV,YAAY,CAAA,OAAQ;uBAAI;oBAAM;wBAAE,MAAM;wBAAS,MAAM;wBAA6C,OAAO;oBAAS;iBAAE;YACpH,4IAAG,CAAC,SAAS;QACjB,SAAU;YACN,WAAW;YACX,cAAc;QAClB;IACJ;IAEA,qBACI,oQAAC;QAAI,WAAU;;0BAEX,oQAAC;gBAAI,WAAU;;kCACX,oQAAC;;0CACG,oQAAC;gCAAG,WAAU;;kDACV,oQAAC;wCAAI,WAAU;;0DACX,oQAAC;gDAAI,WAAW,CAAC,8CAA8C,EAAE,UAAU,iBAAiB,IAAI;;;;;;0DAChG,oQAAC;gDAAI,WAAU;0DACX,cAAA,oQAAC;oDAAI,WAAW,CAAC,qBAAqB,EAAE,aAAa,8BAA8B,eAAe;;;;;;;;;;;;;;;;;oCAEpG;;;;;;;0CAGV,oQAAC;gCAAE,WAAU;0CACR,aAAa,2BAA2B;;;;;;;;;;;;kCAIjD,oQAAC;wBAAI,WAAU;kCACX,cAAA,oQAAC;4BACG,SAAS,IAAM,cAAc,CAAC;4BAC9B,WAAW,CAAC,yHAAyH,EAAE,aAAa,sHAAsH,6DAA6D;sCAEtU,aAAa,kBAAkB;;;;;;;;;;;;;;;;;0BAK5C,oQAAC;gBAAI,WAAU;;kCAEX,oQAAC;wBAAI,WAAU;;0CAEX,oQAAC;gCAAI,WAAU;0CACV,OAAO,GAAG,CAAC,CAAA,sBACR,oQAAC;wCAEG,SAAS,IAAM,iBAAiB,MAAM,EAAE;wCACxC,WAAW,CAAC,kHAAkH,EAAE,kBAAkB,MAAM,EAAE,GAAG,gCAAgC,sDAAsD;;0DAEnP,oQAAC;gDAAI,WAAU;;kEACX,oQAAC;wDAAI,WAAW,CAAC,yFAAyF,EAAE,MAAM,KAAK,EAAE;kEACrH,cAAA,oQAAC;4DAAI,WAAU;4DAAU,MAAK;4DAAO,QAAO;4DAAe,SAAQ;sEAAY,cAAA,oQAAC;gEAAK,eAAc;gEAAQ,gBAAe;gEAAQ,aAAa;gEAAK,GAAG,MAAM,IAAI;;;;;;;;;;;;;;;;kEAErK,oQAAC;;0EACG,oQAAC;gEAAE,WAAW,CAAC,2CAA2C,EAAE,kBAAkB,MAAM,EAAE,GAAG,eAAe,iBAAiB;0EAAG,MAAM,IAAI;;;;;;0EACtI,oQAAC;gEAAE,WAAU;0EAAuC,MAAM,IAAI;;;;;;;;;;;;;;;;;;4CAGrE,kBAAkB,MAAM,EAAE,kBAAI,oQAAC;gDAAI,WAAW,CAAC,mCAAmC,EAAE,MAAM,KAAK,CAAC,OAAO,CAAC,QAAQ,OAAO;;;;;;;uCAbnH,MAAM,EAAE;;;;;;;;;;0CAmBzB,oQAAC;gCAAI,WAAU;;kDACX,oQAAC;wCAAG,WAAW,CAAC,uBAAuB,EAAE,YAAY,KAAK,EAAE;kDAAG,YAAY,IAAI;;;;;;kDAC/E,oQAAC;wCAAE,WAAU;kDAA8C,YAAY,WAAW;;;;;;kDAClF,oQAAC;wCAAI,WAAU;kDACX,cAAA,oQAAC;4CAAI,WAAW,CAAC,aAAa,EAAE,YAAY,KAAK,CAAC,OAAO,CAAC,QAAQ,MAAM,cAAc,CAAC;;;;;;;;;;;;;;;;;;;;;;;kCAMnG,oQAAC;wBAAI,WAAU;;0CAEX,oQAAC;gCAAI,WAAU;;oCACV,SAAS,MAAM,KAAK,mBACjB,oQAAC;wCAAI,WAAU;;0DACX,oQAAC;gDAAI,WAAU;0DACX,cAAA,oQAAC;oDAAI,WAAU;;;;;;;;;;;0DAEnB,oQAAC;gDAAG,WAAU;0DAAiD;;;;;;0DAC/D,oQAAC;gDAAE,WAAU;0DAAsD;;;;;;0DAGnE,oQAAC;gDAAE,WAAU;0DAAiE;;;;;;;;;;;;oCAGrF,SAAS,GAAG,CAAC,CAAC,KAAK,kBAChB,oQAAC;4CAAY,WAAW,CAAC,+CAA+C,EAAE,IAAI,IAAI,KAAK,SAAS,uBAAuB,yBAAyB,gBAAgB,CAAC;;8DAC7J,oQAAC;oDAAK,WAAU;8DACX,IAAI,KAAK,IAAI;;;;;;8DAElB,oQAAC;oDAAI,WAAW,CAAC,uEAAuE,EACpF,IAAI,IAAI,KAAK,SACX,wEACA,IAAI,UAAU,GACV,kEACA,0EACR;;wDACG,IAAI,IAAI;wDACR,IAAI,OAAO,IAAI,IAAI,OAAO,CAAC,MAAM,GAAG,mBACjC,oQAAC;4DAAI,WAAU;;8EACX,oQAAC;oEAAE,WAAU;8EAAoD;;;;;;8EACjE,oQAAC;oEAAI,WAAU;8EACV,IAAI,OAAO,CAAC,GAAG,CAAC,CAAC,KAAK,MACnB,IAAI,GAAG,kBACH,oQAAC;4EAAY,MAAM,IAAI,GAAG,CAAC,GAAG;4EAAE,QAAO;4EAAS,KAAI;4EAAa,WAAU;sFACtE,IAAI,GAAG,CAAC,KAAK;2EADV;;;;;;;;;;;;;;;;;;;;;;;2CAlB1B;;;;;kDA6Bd,oQAAC;wCAAI,KAAK;wCAAa,WAAU;;;;;;;;;;;;0CAIrC,oQAAC;gCAAI,WAAU;;oCACV,8BACG,oQAAC;wCAAI,WAAU;;0DACX,oQAAC;gDAAI,WAAU;gDAAwB,MAAK;gDAAO,SAAQ;gDAAY,QAAO;0DAAe,cAAA,oQAAC;oDAAK,eAAc;oDAAQ,gBAAe;oDAAQ,aAAa;oDAAG,GAAE;;;;;;;;;;;0DAClK,oQAAC;gDAAK,WAAU;0DAAmC,aAAa,IAAI;;;;;;0DACpE,oQAAC;gDAAO,SAAS,IAAM,gBAAgB;gDAAO,WAAU;0DAAsC;;;;;;;;;;;;kDAGtG,oQAAC;wCAAK,UAAU;wCAAc,WAAU;;0DACpC,oQAAC;gDACG,MAAK;gDACL,KAAK;gDACL,UAAU;gDACV,WAAU;gDACV,QAAO;;;;;;0DAEX,oQAAC;gDACG,MAAK;gDACL,SAAS,IAAM,aAAa,OAAO,EAAE;gDACrC,WAAU;gDACV,OAAM;0DAEN,cAAA,oQAAC;oDAAI,WAAU;oDAAU,MAAK;oDAAO,QAAO;oDAAe,SAAQ;8DAAY,cAAA,oQAAC;wDAAK,eAAc;wDAAQ,gBAAe;wDAAQ,aAAa;wDAAG,GAAE;;;;;;;;;;;;;;;;0DAExJ,oQAAC;gDACG,MAAK;gDACL,OAAO;gDACP,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;gDACxC,aAAa,aAAa,2BAA2B,CAAC,kBAAkB,EAAE,YAAY,IAAI,CAAC,GAAG,CAAC;gDAC/F,WAAU;;;;;;0DAEd,oQAAC;gDACG,MAAK;gDACL,UAAU,WAAY,CAAC,MAAM,IAAI,MAAM,CAAC;gDACxC,WAAU;;kEAEV,oQAAC;wDAAK,WAAU;kEAAmB;;;;;;kEACnC,oQAAC;wDAAK,WAAU;kEAAY;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQ5D;uCAEe"}}]
}